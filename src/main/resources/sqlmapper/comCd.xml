<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.hconnect.sqlmapper">

    <!-- 공통코드 by Code 조회 -->
    <select id="selectComCdByCode" parameterType="String" resultType="kr.co.hconnect.vo.ComCdVO">
		<![CDATA[
        SELECT A.COM_CD        	-- 공통코드
             , A.COM_CD_NM      -- 공통코드명
             , A.USE_YN         -- 사용여부
             , A.COM_CD_DIV     -- 공통코드구분
             , A.REMARK         -- 공통코드 리마크
             , A.REG_ID         -- 등록자ID
             , A.REG_DT         -- 등록일자
             , A.UPD_ID         -- 수정자ID
             , A.UPD_DT         -- 수정일자

          FROM COM_CD A
         WHERE A.COM_CD = #{comCd}
        ]]>
	</select>

    <!-- 공통코드 목록 조회 -->
    <select id="selectComCdList" parameterType="kr.co.hconnect.vo.ComCdVO" resultType="kr.co.hconnect.vo.ComCdVO">
        <![CDATA[
		SELECT A.COM_CD        	-- 공통코드
		     , A.COM_CD_NM      -- 공통코드명
		     , A.USE_YN         -- 사용여부
		     , A.COM_CD_DIV     -- 공통코드구분
		     , A.REMARK         -- 공통코드 리마크
		     , A.REG_ID         -- 등록자ID
		     , A.REG_DT         -- 등록일자
		     , A.UPD_ID         -- 수정자ID
		     , A.UPD_DT         -- 수정일자

		  FROM COM_CD A
	]]>
    <choose>
      <when test="useYn == null or useYn == ''">
         WHERE A.USE_YN = IFNULL(UPPER(#{useYn}),'Y')
      </when>
      <otherwise>
         WHERE 1 = 1
      </otherwise>
    </choose>
    <if test="comCd != null and comCd != ''">
           AND A.COM_CD LIKE CONCAT(UPPER(#{comCd}), '%')
    </if>
    <if test="comCdNm != null and comCdNm != ''">
           AND UPPER(A.COM_CD_NM) LIKE CONCAT(UPPER(#{comCdNm}), '%')
    </if>
      ORDER BY A.COM_CD ASC
</select>

    <!-- 공통코드상세 리스트 조회 (selectBox 바인딩용)-->
    <select id="selectComCdDetailList" parameterType="kr.co.hconnect.vo.ComCdDetailListVO" resultType="kr.co.hconnect.vo.ComCdDetailListVO">
        <![CDATA[
		SELECT A.COM_CD        AS COM_CD			-- 공통코드
		     , A.COM_CD_NM     AS COM_CD_NM         -- 공통코드명
		     , A.COM_CD_DIV    AS COM_CD_DIV        -- 공통코드구분
		     , A.REMARK        AS COM_CD_REMARK     -- 공통코드 리마크
		     , B.DETAIL_CD     AS DETAIL_CD         -- 세부코드
		     , B.DETAIL_CD_NM  AS DETAIL_CD_NM      -- 세부코드명
		     , B.PROPERTY1     AS PROPERTY1         -- 속성1
		     , B.PROPERTY2     AS PROPERTY2         -- 속성2
		     , B.PROPERTY3     AS PROPERTY3         -- 속성3
		     , B.USE_YN        AS USE_YN            -- 공통코드상세 사용여부
		     , B.REMARK        AS REMARK            -- 공통코드상세 리마크
		  FROM COM_CD A
		       INNER JOIN COM_CD_DETAIL B ON A.COM_CD = B.COM_CD
		 WHERE A.USE_YN = IFNULL(#{useYn}, 'Y')
		   AND A.COM_CD = #{comCd}
	]]>

        <if test="detailCd != null and detailCd != ''">
            AND B.DETAIL_CD = #{detailCd}
        </if>

        <if test="property1 != null and property1 != ''">
            AND B.PROPERTY1 = #{property1}
        </if>

        <if test="property2 != null and property2 != ''">
            AND B.PROPERTY2 = #{property2}
        </if>

        <if test="property3 != null and property3 != ''">
            AND B.PROPERTY3 = #{property3}
        </if>

    </select>

    <!-- 공통코드 입력 -->
    <insert id="insertComCd" parameterType="kr.co.hconnect.vo.ComCdVO">
	    <![CDATA[
        INSERT INTO COM_CD
                  ( COM_CD                         -- 공통코드
                  , COM_CD_NM                      -- 공통코드명
                  , COM_CD_DIV                     -- 공통코드구분
                  , REMARK                         -- 공통코드 리마크
                  , REG_ID                         -- 등록자
                  , UPD_ID                         -- 수정자
                  )
             VALUES
                  ( #{comCd}
                  , #{comCdNm}
                  , #{comCdDiv}
                  , #{remark}
                  , #{regId}
                  , #{updId}
                  )
        ]]>
	</insert>

    <!-- 공통코드 수정 -->
    <update id="updateComCd" parameterType="kr.co.hconnect.vo.ComCdVO">
        <![CDATA[
        UPDATE COM_CD
           SET COM_CD_NM  = #{comCdNm}                -- 공통코드명
             , COM_CD_DIV = #{comCdDiv}               -- 공통코드구분
             , REMARK     = #{remark}                 -- 리마크
             , UPD_ID     = #{updId}                  -- 수정자
             , UPD_DT     = current_timestamp()       -- 수정일시
         WHERE COM_CD     = #{comCd}                   
        ]]>
	</update>

    <!-- 공통코드 비활성화 update -->
    <update id="deleteComCd" parameterType="String">
        <![CDATA[
        UPDATE COM_CD
           SET USE_YN = 'N'                           -- 사용여부
             , UPD_ID = #{updId}                      -- 수정자
             , UPD_DT = current_timestamp()           -- 수정일시
         WHERE COM_CD = #{comCd}
        ]]>
	</update>

    <!-- 공통코드상세 리스트 조회 -->
    <select id="selectComDetailList" parameterType="kr.co.hconnect.vo.ComCdDetailVO" resultType="kr.co.hconnect.vo.ComCdDetailVO">
        <![CDATA[
		SELECT COM_CD                                    -- 공통코드
		     , DETAIL_CD                                 -- 세부코드
		     , DETAIL_CD_NM                              -- 세부코드명
		     , SORT_SEQ                                  -- 정렬순서
		     , REMARK                                    -- 세부코드 리마크
		     , COALESCE(PROPERTY1,'') AS PROPERTY1       -- 속성1
		     , COALESCE(PROPERTY2,'') AS PROPERTY2       -- 속성2
		     , COALESCE(PROPERTY3,'') AS PROPERTY3       -- 속성3
		     , USE_YN                                    -- 공통코드상세 사용여부
		     , COALESCE(REMARK,'')    AS REMARK          -- 공통코드상세 리마크
		  FROM COM_CD_DETAIL

		]]>
        <choose>
        <when test="useYn == null or useYn == ''">
         WHERE USE_YN = IFNULL(UPPER(#{useYn}),'Y')
           AND COM_CD = UPPER(#{comCd})
        </when>
        <otherwise>
         WHERE COM_CD = UPPER(#{comCd})
        </otherwise>
        </choose>
        <if test="detailCd != null and detailCd != ''">
           AND DETAIL_CD LIKE CONCAT(UPPER(#{detailCd}), '%')
        </if>

        <if test="detailCdNm != null and detailCdNm != ''">
           AND UPPER(DETAIL_CD_NM) LIKE CONCAT(UPPER(#{detailCdNm}), '%')
        </if>

        <if test="property1 != null and property1 != ''">
           AND UPPER(PROPERTY1) LIKE CONCAT(UPPER(#{property1}), '%')
        </if>

        <if test="property2 != null and property2 != ''">
           AND UPPER(PROPERTY2) LIKE CONCAT(UPPER(#{property2}), '%')
        </if>

        <if test="property3 != null and property3 != ''">
           AND UPPER(PROPERTY3) LIKE CONCAT(UPPER(#{property3}), '%')
        </if>
      ORDER BY SORT_SEQ ASC
             , DETAIL_CD ASC
    </select>

    <!-- 세부코드 by Code 조회 -->
    <select id="selectDetailCdByCode" parameterType="kr.co.hconnect.vo.ComCdDetailVO" resultType="kr.co.hconnect.vo.ComCdDetailVO">
        <![CDATA[
        SELECT COM_CD                                    -- 공통코드
             , DETAIL_CD                                 -- 세부코드
             , DETAIL_CD_NM                              -- 세부코드명
             , SORT_SEQ                                  -- 정렬순서
             , REMARK                                    -- 세부코드 리마크
             , COALESCE(PROPERTY1,'') AS PROPERTY1       -- 속성1
             , COALESCE(PROPERTY2,'') AS PROPERTY2       -- 속성2
             , COALESCE(PROPERTY3,'') AS PROPERTY3       -- 속성3
             , USE_YN                                    -- 공통코드상세 사용여부
             , COALESCE(REMARK,'')    AS REMARK          -- 공통코드상세 리마크
          FROM COM_CD_DETAIL                                                     
         WHERE COM_CD    = #{comCd}
           AND DETAIL_CD = #{detailCd}
        ]]>
	</select>


    <!-- 공통코드 세부코드 신규 저장 -->
    <insert id="insertComCdDetail" parameterType="kr.co.hconnect.vo.ComCdDetailVO">
		<![CDATA[
        INSERT
          INTO COM_CD_DETAIL
          ( COM_CD         -- 공통코드
          , DETAIL_CD      -- 세부코드
          , DETAIL_CD_NM   -- 세부코드명
          , SORT_SEQ       -- 정렬순서
          , PROPERTY1      -- 속성1
          , PROPERTY2      -- 속성2
          , PROPERTY3      -- 속성3
          , REMARK         -- 공통코드 리마크
          , REG_ID         -- 등록자ID
          , UPD_ID         -- 수정자ID
          )
        VALUES
          (
            #{comCd}
          , UPPER(#{detailCd})
          , #{detailCdNm}
          , #{sortSeq}
          , #{property1}
          , #{property2}
          , #{property3}
          , #{remark}
          , #{regId}
          , #{updId}
          )
        ]]>
	</insert>


    <!-- 세부코드 수정 -->
    <update id="updateComCdDetail" parameterType="kr.co.hconnect.vo.ComCdDetailVO">
		<![CDATA[
        UPDATE COM_CD_DETAIL
           SET
               DETAIL_CD_NM = #{detailCdNm}               -- 세부코드명
             , SORT_SEQ     = #{sortSeq}                  -- 정렬순서
             , PROPERTY1    = #{property1}                -- property1
             , PROPERTY2    = #{property2}                -- property2
             , PROPERTY3    = #{property3}                -- property3
             , REMARK       = #{remark}                   -- 리마크
             , UPD_ID       = #{updId}                    -- 수정자
             , UPD_DT       = current_timestamp()         -- 수정일시
         WHERE COM_CD       = #{comCd}
           AND DETAIL_CD    = UPPER(#{detailCd})
        ]]>
	</update>

    <!-- 세부코드 비활성화 update -->
    <update id="deleteComDetail" parameterType="kr.co.hconnect.vo.ComCdDetailVO">
		<![CDATA[
        UPDATE COM_CD_DETAIL
           SET
               USE_YN    = 'N'                          -- 사용여부
             , UPD_ID    = #{updId}                     -- 수정자
             , UPD_DT    = current_timestamp()          -- 수정일시
         WHERE COM_CD    = #{comCd}
           AND DETAIL_CD = UPPER(#{detailCd})

        ]]>
	</update>


</mapper>
