<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.co.hconnect.sqlmapper">

    <!-- 측정결과 저장 -->
    <insert id="insertResult" parameterType="kr.co.hconnect.domain.Result"
            useGeneratedKeys="true"
            keyColumn="RESULT_SEQ"
            keyProperty="resultSeq">
    <![CDATA[
        INSERT
          INTO RESULT
             ( ADMISSION_ID
             , ITEM_ID
             , RESULT_DATE
             , RESULT_TIME
             , DEVICE_ID)
        VALUES
             ( #{admissionId}
             , #{itemId}
             , #{resultDate}
             , #{resultTime}
             , #{deviceId})
        ON DUPLICATE KEY UPDATE
          DEVICE_ID = #{deviceId}
        , UPD_DT    = NOW()

        ]]>
    </insert>

    <!-- 측정결과 세부 저장 -->
    <insert id="insertResultDetail" parameterType="kr.co.hconnect.domain.ResultDetail">
    <![CDATA[
        INSERT
        INTO RESULT_DETAIL ( RESULT_SEQ
                           , RESULT_TYPE
                           , RESULT)
        VALUES ( #{resultSeq}
               , #{resultType}
               , #{result})
        ON DUPLICATE KEY UPDATE
          RESULT = #{result}
        ]]>
    </insert>

    <!-- 수면 측정결과 저장 -->
    <insert id="insertResultSleepTime" parameterType="kr.co.hconnect.domain.SaveSleepTimeResult">
        INSERT
          INTO RESULT_SLEEP
             ( ADMISSION_ID
             , RESULT_START_DATE
             , RESULT_START_TIME
             , RESULT_END_DATE
             , RESULT_END_TIME
             , SLEEP_TYPE
             , DEVICE_ID)
        VALUES
             ( #{admissionId}
             , #{resultStartDate}
             , #{resultStartTime}
             , #{resultEndDate}
             , #{resultEndTime}
             , #{sleepType}
             , #{deviceId})
        ON DUPLICATE KEY UPDATE
          SLEEP_TYPE = #{sleepType}
        , DEVICE_ID  = #{deviceId}
        , UPD_DT    = NOW()
    </insert>

</mapper>
